<?php header('Content-Type: application/json'); require_once __DIR__.'/../config/db.php'; $order_id=intval($_GET['order_id']??0); if(!$order_id){ echo json_encode(['error'=>'order_id required']); exit;} $stmt=$conn->prepare('SELECT employee_id FROM orders WHERE id=? LIMIT 1'); $stmt->bind_param('i',$order_id); $stmt->execute(); $r=$stmt->get_result()->fetch_assoc(); if(!$r||empty($r['employee_id'])){ echo json_encode(['error'=>'No employee']); exit;} $emp=$r['employee_id']; $s=$conn->prepare('SELECT lat,lng,updated_at FROM employee_locations WHERE employee_id=? ORDER BY updated_at DESC LIMIT 1'); $s->bind_param('i',$emp); $s->execute(); $loc=$s->get_result()->fetch_assoc(); if(!$loc){ echo json_encode(['error'=>'No location']); exit;} echo json_encode(['employee_id'=>$emp,'lat'=>floatval($loc['lat']),'lng'=>floatval($loc['lng']),'updated_at'=>$loc['updated_at']]); ?>